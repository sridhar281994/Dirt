<WelcomeScreen>:
    name: 'welcome'

    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: 'assets/welcome.png'

        BoxLayout:
            orientation: 'vertical'
            size_hint: None, None
            width: min(root.width * 0.9, dp(620))
            height: min(self.minimum_height, root.height * 0.85)
            spacing: dp(14) if root.width < dp(420) else dp(20)
            padding: dp(18) if root.width < dp(420) else dp(30)
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 0.5
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [20]

            Label:
                text: "Welcome to the Game!"
                font_size: min(self.width * 0.08, sp(28))
                color: 1, 1, 1, 1
                size_hint_y: None
                halign: "center"
                valign: "middle"
                text_size: self.width, None
                height: self.texture_size[1] + dp(20)

            Button:
                text: "Login"
                font_size: min(self.width * 0.05, sp(18))
                size_hint_y: None
                height: dp(48)
                background_color: (0.2, 0.5, 1, 1)
                on_release: root.manager.current = 'login'

            Button:
                text: "Register"
                font_size: min(self.width * 0.05, sp(18))
                size_hint_y: None
                height: dp(48)
                background_color: (0.3, 0.8, 0.3, 1)
                on_release: root.manager.current = 'register'

        Label:
            id: star1
            text: "*"
            font_size: sp(32)
            color: 1, 1, 0.7, 0.8
            size_hint: None, None
            size: dp(30), dp(30)
            pos_hint: {"x": 0.18, "y": 0.72}

        Label:
            id: star2
            text: "*"
            font_size: sp(28)
            color: 1, 0.9, 0.6, 0.7
            size_hint: None, None
            size: dp(26), dp(26)
            pos_hint: {"x": 0.72, "y": 0.78}

        Label:
            text: "¬© 2025 SRTech Games"
            font_size: min(self.width * 0.035, sp(14))
            color: 1, 1, 1, 0.7
            size_hint: None, None
            size: self.texture_size
            pos_hint: {"center_x": 0.5, "y": 0.02}

<LoginScreen>:
    name: "login"
    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/login.png"

        ScrollView:
            size_hint: None, None
            width: min(root.width * 0.9, dp(520))
            height: min(root.height * 0.9, dp(620))
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
            do_scroll_x: False
            bar_width: 0

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(12)
                padding: dp(18)
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.5
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20]

                Label:
                    text: "Secure Login"
                    font_size: sp(26) * root.font_scale
                    color: 1, 1, 1, 1
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1] + dp(8)

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: dp(230)
                    spacing: dp(10)
                    canvas.before:
                        Color:
                            rgba: 0.07, 0.16, 0.32, 0.9
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [16]

                    Label:
                        text: "Account Details"
                        font_size: sp(17) * root.font_scale
                        color: 1, 1, 1, 0.9
                        size_hint_y: None
                        height: self.texture_size[1] + dp(4)

                    TextInput:
                        id: phone_input
                        hint_text: "Email / Username / Phone"
                        multiline: False
                        font_size: max(sp(14), sp(18) * root.font_scale)
                        size_hint_y: None
                        height: dp(50)
                        background_color: (0.98, 0.95, 0.9, 0.95)
                        foreground_color: (0.09, 0.1, 0.14, 1)
                        padding: [dp(14), dp(10), dp(14), dp(10)]

                    RelativeLayout:
                        size_hint_y: None
                        height: dp(52)
                        TextInput:
                            id: password_input
                            hint_text: "Account password"
                            password: login_password_toggle.state != "down"
                            multiline: False
                            font_size: max(sp(14), sp(18) * root.font_scale)
                            size_hint: 1, 1
                            background_color: (0.92, 0.96, 1, 0.95)
                            foreground_color: (0.09, 0.1, 0.14, 1)
                            padding: [dp(14), dp(10), dp(46), dp(10)]
                        ToggleButton:
                            id: login_password_toggle
                            size_hint: None, None
                            size: dp(40), dp(40)
                            pos_hint: {"right": 1, "center_y": 0.5}
                            text: "üôà" if self.state == "down" else "üëÅ"
                            background_normal: ""
                            background_down: ""
                            border: (0, 0, 0, 0)
                            background_color: (0, 0, 0, 0)
                            color: (0.1, 0.2, 0.35, 1)
                            on_state: password_input.cursor = password_input.cursor

                    Button:
                        text: "Request OTP"
                        size_hint_y: None
                        height: dp(44)
                        font_size: sp(17) * root.font_scale
                        background_normal: ""
                        background_color: (0.96, 0.58, 0.17, 1)
                        color: (0.1, 0.05, 0.02, 1)
                        on_release: root.send_otp_to_user()

                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(10)
                    size_hint_y: None
                    height: dp(210)
                    padding: dp(12)
                    canvas.before:
                        Color:
                            rgba: 0.22, 0.09, 0.24, 0.85
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [16]

                    Label:
                        text: "OTP Verification"
                        font_size: sp(17) * root.font_scale
                        color: 1, 1, 1, 0.9
                        size_hint_y: None
                        height: self.texture_size[1] + dp(4)

                    TextInput:
                        id: otp_input
                        hint_text: "Enter OTP (from email)"
                        multiline: False
                        font_size: max(sp(14), sp(18) * root.font_scale)
                        size_hint_y: None
                        height: dp(48)
                        background_color: (0.92, 0.98, 0.95, 0.95)
                        foreground_color: (0.09, 0.1, 0.14, 1)
                        padding: [dp(14), dp(10), dp(14), dp(10)]

                    Button:
                        text: "Verify & Login"
                        size_hint_y: None
                        height: dp(46)
                        font_size: sp(18)
                        background_normal: ""
                        background_color: (0.37, 0.83, 0.55, 1)
                        color: (0.05, 0.08, 0.08, 1)
                        on_release: root.verify_and_login()

                    Button:
                        text: "Forgot Password?"
                        size_hint_y: None
                        height: dp(40)
                        font_size: sp(16)
                        background_color: (0, 0, 0, 0)
                        color: (1, 1, 1, 0.9)
                        on_release: root.open_forgot_password()

                Button:
                    text: "Back"
                    size_hint_y: None
                    height: dp(42)
                    font_size: sp(16)
                    background_normal: ""
                    background_color: (0.6, 0.2, 0.2, 0.9)
                    color: (1, 1, 1, 1)
                    on_release: root.go_back()

        Button:
            text: "Back"
            font_size: sp(18)
            size_hint: None, None
            size: dp(100), dp(45)
            pos_hint: {"x": 0.02, "y": 0.02}
            background_color: (0.2, 0.2, 0.2, 0.8)
            on_release: root.go_back()

<ForgotPasswordScreen>:
    name: "forgot_password"
    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/login.png"

        ScrollView:
            size_hint: 0.94, 0.78
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
            do_scroll_y: True
            do_scroll_x: False

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                size_hint_x: None
                height: self.minimum_height
                width: min(root.width * 0.9, dp(520))
                pos_hint: {"center_x": 0.5}
                spacing: dp(12) if root.width < dp(420) else dp(16)
                padding: dp(16) if root.width < dp(420) else dp(22)
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.45
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20]

                Label:
                    text: "Forgot Password"
                    font_size: sp(24)
                    color: 1, 1, 1, 1
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1] + dp(20)

                TextInput:
                    id: phone_input
                    hint_text: "Enter registered phone"
                    input_filter: "int"
                    multiline: False
                    font_size: sp(18)
                    size_hint_y: None
                    height: dp(48)
                    background_color: (1, 1, 1, 0.85)
                    foreground_color: (0, 0, 0, 1)

                Button:
                    text: "Send OTP"
                    size_hint_y: None
                    height: dp(48)
                    font_size: sp(18)
                    disabled: root.is_processing
                    on_release: root.send_reset_otp()

                TextInput:
                    id: otp_input
                    hint_text: "Enter OTP"
                    multiline: False
                    font_size: sp(18)
                    size_hint_y: None
                    height: dp(48)
                    background_color: (1, 1, 1, 0.85)
                    foreground_color: (0, 0, 0, 1)
                    disabled: not root.otp_stage_ready

                Button:
                    id: verify_btn
                    text: "Verify OTP"
                    size_hint_y: None
                    height: dp(48)
                    font_size: sp(18)
                    disabled: (not root.otp_stage_ready) or root.is_processing
                    on_release: root.verify_otp_and_continue()

        Button:
            text: "Back"
            font_size: sp(18)
            size_hint: None, None
            size: dp(100), dp(45)
            pos_hint: {"x": 0.02, "y": 0.02}
            background_color: (0.2, 0.2, 0.2, 0.8)
            on_release: root.go_back()

<ResetPasswordScreen>:
    name: "reset_password"
    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/login.png"

        ScrollView:
            size_hint: 0.94, 0.72
            pos_hint: {"center_x": 0.5, "center_y": 0.57}
            do_scroll_y: True
            do_scroll_x: False

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                size_hint_x: None
                height: self.minimum_height
                width: min(root.width * 0.9, dp(520))
                pos_hint: {"center_x": 0.5}
                spacing: dp(12) if root.width < dp(420) else dp(16)
                padding: dp(16) if root.width < dp(420) else dp(22)
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.45
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20]

                Label:
                    text: "Set a new password"
                    font_size: sp(24)
                    color: 1, 1, 1, 1
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1] + dp(15)

                Label:
                    text: "Phone: " + (root.current_phone or "--")
                    font_size: sp(16)
                    color: 1, 1, 1, 0.9
                    size_hint_y: None
                    height: dp(30)

                RelativeLayout:
                    size_hint_y: None
                    height: dp(48)
                    TextInput:
                        id: password_input
                        hint_text: "New password"
                        password: reset_password_toggle.state != "down"
                        multiline: False
                        font_size: sp(18)
                        size_hint: 1, 1
                        background_color: (1, 1, 1, 0.85)
                        foreground_color: (0, 0, 0, 1)
                        padding: [dp(12), dp(10), dp(46), dp(10)]
                    ToggleButton:
                        id: reset_password_toggle
                        size_hint: None, None
                        size: dp(40), dp(40)
                        pos_hint: {"right": 1, "center_y": 0.5}
                        text: "üôà" if self.state == "down" else "üëÅ"
                        background_normal: ""
                        background_down: ""
                        border: (0, 0, 0, 0)
                        background_color: (0, 0, 0, 0)
                        color: (0, 0, 0, 1)
                        on_state: password_input.cursor = password_input.cursor

                RelativeLayout:
                    size_hint_y: None
                    height: dp(48)
                    TextInput:
                        id: confirm_password_input
                        hint_text: "Confirm password"
                        password: reset_confirm_toggle.state != "down"
                        multiline: False
                        font_size: sp(18)
                        size_hint: 1, 1
                        background_color: (1, 1, 1, 0.85)
                        foreground_color: (0, 0, 0, 1)
                        padding: [dp(12), dp(10), dp(46), dp(10)]
                    ToggleButton:
                        id: reset_confirm_toggle
                        size_hint: None, None
                        size: dp(40), dp(40)
                        pos_hint: {"right": 1, "center_y": 0.5}
                        text: "üôà" if self.state == "down" else "üëÅ"
                        background_normal: ""
                        background_down: ""
                        border: (0, 0, 0, 0)
                        background_color: (0, 0, 0, 0)
                        color: (0, 0, 0, 1)
                        on_state: confirm_password_input.cursor = confirm_password_input.cursor

                Button:
                    text: "Save Password"
                    size_hint_y: None
                    height: dp(48)
                    font_size: sp(18)
                    disabled: root.is_processing
                    on_release: root.save_new_password()

        BoxLayout:
            size_hint: 1, None
            height: dp(55)
            padding: dp(20)

            Button:
                text: "Back"
                font_size: sp(18)
                size_hint: None, None
                size: dp(120), dp(45)
                background_color: (0.2, 0.2, 0.2, 0.8)
                on_release: root.go_back()

<RegisterScreen>:
    name: "register"
    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/login.png"

        ScrollView:
            size_hint: 0.94, 0.9
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            do_scroll_y: True
            do_scroll_x: False

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                size_hint_x: None
                height: self.minimum_height
                width: min(root.width * 0.92, dp(620))
                pos_hint: {"center_x": 0.5}
                spacing: dp(12) if root.width < dp(480) else dp(16)
                padding: dp(16) if root.width < dp(480) else dp(26)
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.45
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20]

                Label:
                    text: "Create your account"
                    font_size: "26sp"
                    color: 1, 1, 1, 1
                    halign: "center"
                    valign: "middle"
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)

                TextInput:
                    id: name_input
                    hint_text: "Full Name"
                    size_hint_y: None
                    height: dp(50)
                    font_size: "18sp"
                    background_color: (1, 1, 1, 0.85)
                    foreground_color: (0, 0, 0, 1)

                TextInput:
                    id: phone_input
                    hint_text: "Phone (10 digits)"
                    input_filter: "int"
                    size_hint_y: None
                    height: dp(50)
                    font_size: "18sp"
                    background_color: (1, 1, 1, 0.85)
                    foreground_color: (0, 0, 0, 1)

                TextInput:
                    id: email_input
                    hint_text: "Email"
                    size_hint_y: None
                    height: dp(50)
                    font_size: "18sp"
                    background_color: (1, 1, 1, 0.85)
                    foreground_color: (0, 0, 0, 1)

                RelativeLayout:
                    size_hint_y: None
                    height: dp(50)
                    TextInput:
                        id: password_input
                        hint_text: "Password"
                        password: register_password_toggle.state != "down"
                        size_hint: 1, 1
                        font_size: "18sp"
                        background_color: (1, 1, 1, 0.85)
                        foreground_color: (0, 0, 0, 1)
                        padding: [dp(12), dp(12), dp(46), dp(12)]
                    ToggleButton:
                        id: register_password_toggle
                        size_hint: None, None
                        size: dp(40), dp(40)
                        pos_hint: {"right": 1, "center_y": 0.5}
                        text: "üôà" if self.state == "down" else "üëÅ"
                        background_normal: ""
                        background_down: ""
                        border: (0, 0, 0, 0)
                        background_color: (0, 0, 0, 0)
                        color: (0, 0, 0, 1)
                        on_state: password_input.cursor = password_input.cursor

                TextInput:
                    id: upi_input
                    hint_text: "UPI ID (optional)"
                    size_hint_y: None
                    height: dp(50)
                    font_size: "18sp"
                    background_color: (1, 1, 1, 0.85)
                    foreground_color: (0, 0, 0, 1)

                BoxLayout:
                    size_hint_y: None
                    height: dp(50)
                    spacing: dp(10)
                    Button:
                        text: "Register"
                        font_size: "18sp"
                        background_color: (0.3, 0.7, 0.3, 1)
                        on_release: root.save_profile()

        Button:
            text: "Back"
            size_hint: None, None
            size: dp(90), dp(42)
            pos_hint: {"x": 0.02, "y": 0.02}
            background_color: (0.15, 0.15, 0.15, 0.8)
            font_size: "16sp"
            on_release: app.root.current = "welcome"
